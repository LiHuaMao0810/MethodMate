# AI服务切换功能说明

## 功能概述

MethodMate现在支持在Coze和ChatGPT之间切换AI服务，用户可以根据需要选择不同的AI服务来处理各种任务。

## 切换方式

### 1. 环境调试工具切换

1. **打开调试工具**：
   - 开发模式下，右下角会显示🔧按钮
   - 点击按钮打开环境调试工具

2. **选择AI服务**：
   - 在"AI服务选择"区域
   - 点击"🤖 Coze"或"💬 ChatGPT"按钮
   - 当前选择的服务会高亮显示

3. **确认切换**：
   - 切换后会在控制台显示确认信息
   - 界面会显示当前使用的AI服务

### 2. 快捷键切换

- 按 `Ctrl/Cmd + Shift + E` 打开/关闭调试工具

## 支持的功能

### ✅ 已适配的功能

1. **聊天对话**
   - 左侧聊天框的AI对话
   - 支持流式输出（ChatGPT模拟流式效果）

2. **研究方案生成**
   - 定量研究方案完整生成
   - 来源介绍生成
   - 方法介绍生成
   - 方案评估和迭代优化

3. **文献处理**
   - 研究方法概要生成
   - 论文全文处理和分析

4. **关键词提取**
   - 从对话历史中提取学术关键词
   - 用于文献推荐

5. **统计方法查询**
   - 查询和解释统计方法
   - 支持本地数据库和AI生成

### ⚠️ 部分适配的功能

1. **文献推荐**
   - 仍使用原有的后端API
   - 后续版本将完全适配

## 技术实现

### 核心组件

1. **AI服务状态管理** (`src/stores/aiServiceStore.js`)
   - 管理当前选择的AI服务
   - 持久化保存用户选择

2. **AI服务适配器** (`src/services/aiServiceAdapter.js`)
   - 统一的API接口
   - 根据当前服务调用相应的实现

3. **环境调试工具** (`src/components/EnvironmentDebugTool.vue`)
   - 提供AI服务切换界面
   - 显示当前状态

### 适配流程

1. **导入适配器**：
   ```javascript
   import { sendStreamMessage } from '../services/aiServiceAdapter.js'
   ```

2. **调用统一接口**：
   ```javascript
   const response = await sendStreamMessage(message, onChunk, chatHistory)
   ```

3. **自动服务选择**：
   - 适配器根据当前设置自动选择Coze或ChatGPT
   - 无需修改业务逻辑代码

## 配置要求

### Coze配置
- 使用现有的Coze API配置
- 无需额外设置

### ChatGPT配置
- 需要在`.env`文件中配置：
  ```env
  VITE_CHATGPT_API_KEY=your_openai_api_key
  VITE_CHATGPT_BASE_URL=https://api.openai.com/v1/chat/completions
  VITE_CHATGPT_MODEL=gpt-4o
  VITE_CHATGPT_MAX_TOKENS=2000
  VITE_CHATGPT_TEMPERATURE=0.7
  ```

## 使用建议

### 何时使用Coze
- 需要专业的学术研究支持
- 使用预训练的专业智能体
- 需要特定领域的深度理解

### 何时使用ChatGPT
- 需要更通用的AI能力
- 处理多样化的任务
- 需要更快的响应速度

## 测试功能

### 开发模式测试
- 首页会显示AI服务测试组件
- 可以测试不同服务的响应效果
- 包含流式消息、静默消息、关键词提取等测试

### 测试步骤
1. 选择要测试的AI服务
2. 输入测试消息
3. 点击相应的测试按钮
4. 查看测试结果和性能对比

## 故障排除

### 常见问题

1. **ChatGPT无响应**
   - 检查API密钥配置
   - 确认网络连接
   - 查看控制台错误信息

2. **Coze服务异常**
   - 检查Coze API状态
   - 确认智能体配置
   - 查看后端日志

3. **切换无效**
   - 刷新页面重试
   - 清除浏览器缓存
   - 检查localStorage设置

### 调试信息
- 打开浏览器开发者工具
- 查看控制台日志
- 关注网络请求状态

## 后续计划

### 即将适配的功能
1. 文献推荐系统完全适配
2. 更多AI服务选项（如Claude、文心一言等）
3. 自动服务选择（根据任务类型）
4. 性能监控和统计

### 优化方向
1. 响应速度优化
2. 错误处理改进
3. 用户体验提升
4. 成本控制机制

## 注意事项

1. **API费用**：ChatGPT使用会产生API费用，请合理使用
2. **数据隐私**：两种服务的数据处理政策可能不同
3. **功能差异**：不同服务的能力和特点有所区别
4. **网络要求**：ChatGPT需要稳定的国际网络连接

---

*最后更新：2024年12月* 