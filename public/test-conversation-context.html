<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>对话历史提取测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .input-group {
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>对话历史提取功能测试</h1>
        <p>这个页面用于测试从对话历史中提取用户需求和研究上下文的功能。</p>

        <div class="test-section">
            <h3>测试对话历史</h3>
            <div class="input-group">
                <label for="conversationInput">输入模拟的对话历史（用户消息）：</label>
                <textarea id="conversationInput" placeholder="请输入模拟的用户消息，每条消息用换行分隔...">我想研究用户界面设计对用户体验的影响
我的研究目标是了解不同界面设计元素如何影响用户的操作效率
我计划使用问卷调查和眼动追踪实验来收集数据
主要关注的因素包括界面布局、颜色搭配和交互反馈
我希望能够量化这些设计元素对用户满意度的影响
我的研究背景是在线教育平台，需要优化学习界面的用户体验
我想使用t检验和方差分析来比较不同设计方案的差异
我的研究问题是如何设计更符合用户认知习惯的界面</textarea>
            </div>
            <button onclick="testExtraction()">测试提取功能</button>
            <button onclick="clearResults()">清空结果</button>
            <div id="extractionResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>功能说明</h3>
            <p>这个功能会从对话历史中提取以下类型的信息：</p>
            <ul>
                <li><span class="highlight">研究主题和领域</span>：包含"研究"、"实验"、"调查"等关键词的句子</li>
                <li><span class="highlight">研究目标</span>：包含"目标"、"目的"、"想要"等关键词的句子</li>
                <li><span class="highlight">研究变量和指标</span>：包含"变量"、"指标"、"测量"等关键词的句子</li>
                <li><span class="highlight">研究方法和设计偏好</span>：包含"方法"、"设计"、"问卷"等关键词的句子</li>
                <li><span class="highlight">研究背景和上下文</span>：包含"背景"、"现状"、"问题"等关键词的句子</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>预期效果</h3>
            <p>优化后的系统将能够：</p>
            <ul>
                <li>结合用户的具体需求生成个性化的研究方案</li>
                <li>在评估方案时考虑需求匹配度</li>
                <li>在迭代优化时优先考虑用户偏好</li>
                <li>生成更贴合用户研究背景的来源介绍和方法说明</li>
            </ul>
        </div>
    </div>

    <script>
        function testExtraction() {
            const input = document.getElementById('conversationInput').value;
            if (!input.trim()) {
                alert('请输入对话历史内容');
                return;
            }

            // 模拟提取功能
            const result = simulateExtraction(input);
            displayResult(result);
        }

        function simulateExtraction(text) {
            const messages = text.split('\n').filter(line => line.trim());
            const userRequirements = [];
            const researchContext = [];

            for (const msg of messages) {
                const content = msg.toLowerCase();
                
                // 提取研究主题和领域
                if (content.includes('研究') || content.includes('实验') || content.includes('调查')) {
                    const sentences = msg.split(/[。！？\n]/).filter(s => 
                        s.includes('研究') || s.includes('实验') || s.includes('调查') || 
                        s.includes('分析') || s.includes('评估') || s.includes('测试')
                    );
                    userRequirements.push(...sentences);
                }
                
                // 提取具体的研究目标
                if (content.includes('目标') || content.includes('目的') || content.includes('想要')) {
                    const sentences = msg.split(/[。！？\n]/).filter(s => 
                        s.includes('目标') || s.includes('目的') || s.includes('想要') ||
                        s.includes('希望') || s.includes('需要')
                    );
                    userRequirements.push(...sentences);
                }
                
                // 提取研究变量和指标
                if (content.includes('变量') || content.includes('指标') || content.includes('测量') || 
                    content.includes('因素') || content.includes('影响') || content.includes('关系')) {
                    const sentences = msg.split(/[。！？\n]/).filter(s => 
                        s.includes('变量') || s.includes('指标') || s.includes('测量') ||
                        s.includes('因素') || s.includes('影响') || s.includes('关系')
                    );
                    userRequirements.push(...sentences);
                }
                
                // 提取研究方法和设计偏好
                if (content.includes('方法') || content.includes('设计') || content.includes('问卷') ||
                    content.includes('访谈') || content.includes('观察') || content.includes('实验')) {
                    const sentences = msg.split(/[。！？\n]/).filter(s => 
                        s.includes('方法') || s.includes('设计') || s.includes('问卷') ||
                        s.includes('访谈') || s.includes('观察') || s.includes('实验')
                    );
                    userRequirements.push(...sentences);
                }
                
                // 提取研究背景和上下文信息
                if (content.includes('背景') || content.includes('现状') || content.includes('问题') ||
                    content.includes('领域') || content.includes('行业') || content.includes('应用')) {
                    const sentences = msg.split(/[。！？\n]/).filter(s => 
                        s.includes('背景') || s.includes('现状') || s.includes('问题') ||
                        s.includes('领域') || s.includes('行业') || s.includes('应用')
                    );
                    researchContext.push(...sentences);
                }
            }

            // 去重并清理
            const uniqueRequirements = [...new Set(userRequirements)].filter(req => req.trim().length > 5);
            const uniqueContext = [...new Set(researchContext)].filter(ctx => ctx.trim().length > 5);

            return {
                hasUserRequirements: uniqueRequirements.length > 0,
                userRequirements: uniqueRequirements.slice(0, 5).join('\n• '),
                researchContext: uniqueContext.slice(0, 3).join('\n• '),
                requirementCount: uniqueRequirements.length,
                contextCount: uniqueContext.length,
                allRequirements: uniqueRequirements,
                allContext: uniqueContext
            };
        }

        function displayResult(result) {
            const resultDiv = document.getElementById('extractionResult');
            let html = '<h4>提取结果：</h4>';
            
            html += `<p><strong>是否检测到用户需求：</strong> ${result.hasUserRequirements ? '是' : '否'}</p>`;
            html += `<p><strong>需求数量：</strong> ${result.requirementCount}</p>`;
            html += `<p><strong>上下文数量：</strong> ${result.contextCount}</p>`;
            
            if (result.userRequirements) {
                html += `<p><strong>提取的用户需求：</strong></p>`;
                html += `<div style="background: #e7f3ff; padding: 10px; border-radius: 4px; margin: 10px 0;">`;
                html += result.userRequirements;
                html += '</div>';
            }
            
            if (result.researchContext) {
                html += `<p><strong>提取的研究上下文：</strong></p>`;
                html += `<div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0;">`;
                html += result.researchContext;
                html += '</div>';
            }
            
            html += `<p><strong>详细提取信息：</strong></p>`;
            html += `<p>所有需求句子：</p>`;
            html += `<pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px;">${JSON.stringify(result.allRequirements, null, 2)}</pre>`;
            
            html += `<p>所有上下文句子：</p>`;
            html += `<pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px;">${JSON.stringify(result.allContext, null, 2)}</pre>`;
            
            resultDiv.innerHTML = html;
            resultDiv.style.display = 'block';
        }

        function clearResults() {
            document.getElementById('extractionResult').style.display = 'none';
            document.getElementById('conversationInput').value = '';
        }
    </script>
</body>
</html> 