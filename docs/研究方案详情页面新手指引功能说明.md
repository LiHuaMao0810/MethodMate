# 研究方案详情页面新手指引功能说明

## 功能概述

为研究方案详情页面（ResearchPlanDetail.vue）添加了完整的新手指引功能，帮助用户快速了解页面各功能模块的使用方法。

## 功能特性

### 1. 引导步骤设计
- **7个核心步骤**：覆盖页面的主要功能模块
- **智能聚焦**：自动滚动到当前引导元素位置
- **视觉高亮**：蓝色边框高亮当前引导的元素
- **进度指示**：显示当前步骤和总步骤数

### 2. 引导步骤详情

#### 步骤1：生成研究方案
- **目标元素**：生成定量研究方案按钮
- **功能说明**：点击这个按钮可以生成定量的研究方案，AI会根据您的需求和参考文献智能生成完整的研究设计

#### 步骤2：方案导航
- **目标元素**：完整方案导航按钮
- **功能说明**：这里可以切换查看不同的方案部分：完整方案、研究假设、实验设计、数据分析、结果呈现

#### 步骤3：方案评估
- **目标元素**：整体评估按钮
- **功能说明**：生成方案后，可以点击"整体评估"按钮让AI评估方案的完整性和科学性

#### 步骤4：方案迭代
- **目标元素**：方案迭代按钮
- **功能说明**：点击"方案迭代"按钮可以根据您的建议对方案进行优化和改进

#### 步骤5：生成来源介绍
- **目标元素**：生成来源介绍按钮
- **功能说明**：基于您选择的参考文献，AI可以生成当前部分的来源说明，帮助您了解研究背景

#### 步骤6：生成方法介绍
- **目标元素**：生成方法介绍按钮
- **功能说明**：在数据分析部分，可以生成详细的研究方法介绍和统计分析方法说明

#### 步骤7：统计方法查询
- **目标元素**：统计方法查询按钮
- **功能说明**：在数据分析部分，可以查询各种统计方法的详细说明和使用场景

## 交互方式

### 1. 自动启动
- 首次访问页面时自动显示新手指引
- 延迟1秒启动，确保页面完全加载

### 2. 手动控制
- **知道了**：进入下一步引导
- **跳过**：直接结束引导
- **下次不提示**：设置不再显示引导

### 3. 键盘快捷键
- **Enter/空格**：进入下一步
- **Esc**：跳过引导
- **←→方向键**：切换步骤（支持后退）

### 4. 开发模式功能
- **重置引导**：开发模式下显示重置按钮
- **状态管理**：可清除本地存储的引导状态

## 视觉设计

### 1. 遮罩层
- 半透明黑色背景（opacity: 50%）
- 平滑的淡入淡出动画效果

### 2. 高亮区域
- 蓝色边框（border-blue-400）
- 淡蓝色背景（bg-blue-50 bg-opacity-20）
- 呼吸动画效果（2秒循环）

### 3. 提示框
- 白色背景，圆角设计
- 阴影效果增强层次感
- 毛玻璃效果（backdrop-filter）
- 淡入动画（0.3秒）

### 4. 进度指示
- 步骤计数器（当前/总数）
- 圆点进度条
- 已完成步骤高亮显示

## 状态管理

### 1. 本地存储
- **键名**：`researchPlanDetail_tutorial_shown`
- **值**：`'true'` 表示已显示过引导
- **清除方式**：开发模式下的重置按钮

### 2. 响应式状态
- `showTutorial`：控制引导显示/隐藏
- `currentTutorialStep`：当前步骤索引
- `isDevelopment`：开发模式判断

## 技术实现

### 1. 核心组件
```javascript
// 引导步骤定义
const tutorialSteps = [
  {
    title: '生成研究方案',
    description: '...',
    ref: generatePlanBtnRef
  },
  // ... 其他步骤
]

// 计算样式
const highlightStyle = computed(() => {
  // 计算高亮区域位置和尺寸
})

const tooltipStyle = computed(() => {
  // 计算提示框位置，避免超出屏幕
})
```

### 2. 事件处理
```javascript
// 键盘事件处理
const handleKeydown = (event) => {
  switch (event.key) {
    case 'Enter':
    case ' ':
      nextTutorialStep()
      break
    case 'Escape':
      skipTutorial()
      break
    // ... 其他快捷键
  }
}
```

### 3. 生命周期管理
```javascript
onMounted(() => {
  // 添加键盘事件监听
  document.addEventListener('keydown', handleKeydown)
  
  // 检查是否需要显示引导
  if (shouldShowTutorial()) {
    setTimeout(() => startTutorial(), 1000)
  }
})

onUnmounted(() => {
  // 清理事件监听
  document.removeEventListener('keydown', handleKeydown)
})
```

## 使用方法

### 1. 首次使用
1. 访问研究方案详情页面
2. 等待1秒后自动显示新手指引
3. 按照提示逐步了解各功能模块
4. 点击"知道了"进入下一步

### 2. 跳过引导
- 点击"跳过"按钮直接结束引导
- 按Esc键快速跳过
- 点击"下次不提示"设置不再显示

### 3. 重新体验（开发模式）
- 在开发环境下，页面右下角显示"重置引导"按钮
- 点击按钮清除本地存储状态
- 刷新页面重新体验引导

## 自定义配置

### 1. 修改引导步骤
```javascript
const tutorialSteps = [
  {
    title: '自定义标题',
    description: '自定义描述',
    ref: customElementRef
  }
]
```

### 2. 调整样式
```css
/* 修改高亮颜色 */
.tutorial-highlight {
  border-color: #your-color;
  background-color: rgba(your-color, 0.1);
}

/* 修改动画效果 */
@keyframes tutorial-highlight {
  /* 自定义动画 */
}
```

### 3. 更改存储键名
```javascript
const shouldShowTutorial = () => {
  const tutorialShown = localStorage.getItem('your-custom-key')
  return tutorialShown !== 'true'
}
```

## 注意事项

### 1. 元素引用
- 确保所有引导元素都有正确的ref引用
- 动态元素需要在DOM更新后重新获取引用

### 2. 屏幕适配
- 提示框位置计算考虑了屏幕边界
- 小屏幕设备可能需要调整提示框尺寸

### 3. 性能优化
- 使用computed属性缓存样式计算
- 事件监听器在组件卸载时正确清理

### 4. 无障碍访问
- 支持键盘导航
- 提供清晰的视觉反馈
- 考虑屏幕阅读器兼容性

## 与文献推荐页面的区别

### 1. 引导步骤数量
- **文献推荐页面**：6个步骤
- **研究方案详情页面**：7个步骤

### 2. 功能重点
- **文献推荐页面**：侧重文献搜索和选择功能
- **研究方案详情页面**：侧重方案生成、评估和优化功能

### 3. 存储键名
- **文献推荐页面**：`paperDetail_tutorial_shown`
- **研究方案详情页面**：`researchPlanDetail_tutorial_shown`

### 4. 元素引用
- 两个页面使用不同的ref命名，避免冲突
- 研究方案详情页面包含更多功能按钮的引导

## 未来扩展

### 1. 功能增强
- 添加引导步骤的跳过选项
- 支持自定义引导路径
- 增加引导完成后的反馈收集

### 2. 用户体验优化
- 添加引导步骤的预览功能
- 支持引导进度的保存和恢复
- 增加引导内容的国际化支持

### 3. 技术改进
- 优化动画性能
- 增强移动端适配
- 添加引导内容的动态加载 