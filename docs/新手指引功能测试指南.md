# 研究方案详情页面新手指引功能测试指南

## 功能概述

研究方案详情页面（ResearchPlanDetail.vue）的新手指引功能已简化为只引导四个核心按钮：

1. **生成定量研究方案** - 左侧聊天框下方的紫色按钮
2. **生成来源介绍** - 右侧内容区域的来源介绍按钮
3. **生成方法介绍** - 数据分析部分的方法介绍按钮
4. **统计方法查询** - 数据分析部分的统计方法查询按钮

## 引导逻辑改进

### 智能页面状态切换
- **第一步**：自动切换到完整方案页面，聚焦生成定量研究方案按钮
- **第二步**：优先选择数据分析部分的来源介绍按钮，自动切换到数据分析的来源介绍子页面
- **第三步**：自动切换到数据分析部分的方法介绍子页面，聚焦生成方法介绍按钮
- **第四步**：自动切换到数据分析部分的统计方法查询子页面，聚焦统计方法查询按钮

### 重试机制
- 如果元素不存在，系统会自动重试一次（500ms延迟）
- 重试失败后才会跳到下一步，避免因页面切换延迟导致的聚焦失败

## 测试步骤

### 1. 基本功能测试

#### 1.1 首次访问测试
- 清除浏览器本地存储：`localStorage.removeItem('researchPlanDetail_tutorial_shown')`
- 刷新页面，应该自动显示新手指引
- 验证只显示4个步骤的引导

#### 1.2 步骤导航测试
- 点击"知道了"按钮，应该进入下一步
- 使用键盘快捷键：
  - `Enter` 或 `空格`：下一步
  - `Esc`：跳过引导
  - `←` `→`：切换步骤
- 验证步骤指示器显示正确的进度（1/4, 2/4, 3/4, 4/4）

### 2. 元素聚焦测试

#### 2.1 生成定量研究方案按钮
- 第一步应该聚焦到左侧的"生成定量研究方案"按钮
- 验证高亮区域正确包围按钮
- 验证提示框位置合理

#### 2.2 生成来源介绍按钮
- 第二步应该优先聚焦到数据分析部分的来源介绍按钮
- 自动切换到数据分析部分的来源介绍子页面
- 验证按钮正确高亮，不会自动跳过

#### 2.3 生成方法介绍按钮
- 第三步应该自动切换到数据分析页面的方法介绍子部分
- 验证方法介绍按钮正确聚焦，不会自动跳过
- 验证页面切换流畅

#### 2.4 统计方法查询按钮
- 第四步应该自动切换到数据分析页面的统计方法查询子部分
- 验证查询按钮正确聚焦，不会自动跳过
- 验证页面切换流畅

### 3. 页面状态切换测试

#### 3.1 自动页面切换
- 验证引导过程中页面会自动切换到正确的部分
- 数据分析部分会自动切换到正确的子部分（来源介绍/方法介绍/统计方法查询）
- 验证切换过程流畅，不会出现闪烁

#### 3.2 重试机制测试
- 模拟页面切换延迟，验证重试机制是否正常工作
- 检查控制台日志，确认重试逻辑正确执行
- 验证最终能够正确聚焦到目标元素

### 4. 完成和跳过测试

#### 4.1 完成引导
- 完成所有4个步骤后，引导应该自动结束
- 验证本地存储被正确设置：`localStorage.getItem('researchPlanDetail_tutorial_shown')` 应该返回 `'true'`

#### 4.2 跳过引导
- 点击"跳过"按钮，引导应该立即结束
- 点击"下次不提示"按钮，引导应该结束并设置本地存储

### 5. 开发模式调试

#### 5.1 重置功能
- 在开发模式下，右下角应该显示"重置引导"按钮
- 点击后应该清除本地存储，下次访问时重新显示引导

#### 5.2 调试功能
- 点击"调试元素"按钮，控制台应该输出所有元素引用状态
- 验证调试信息正确显示每个步骤的元素存在性

## 预期行为

### 正确的引导流程
1. 页面加载后自动显示第一步（生成定量研究方案）
2. 点击"知道了"后进入第二步（生成来源介绍），自动切换到数据分析部分的来源介绍子页面
3. 点击"知道了"后进入第三步（生成方法介绍），页面自动切换到数据分析部分的方法介绍子页面
4. 点击"知道了"后进入第四步（统计方法查询），页面自动切换到数据分析部分的查询子页面
5. 点击"知道了"后引导完成

### 错误处理
- 如果元素不存在，系统会重试一次（500ms延迟）
- 重试失败后才会跳到下一步
- 控制台会输出详细的调试信息

## 常见问题排查

### 问题1：引导不显示
- 检查本地存储：`localStorage.getItem('researchPlanDetail_tutorial_shown')`
- 如果是 `'true'`，需要重置：`localStorage.removeItem('researchPlanDetail_tutorial_shown')`

### 问题2：元素聚焦不正确
- 使用调试功能检查元素引用状态
- 检查页面是否正确切换到了对应的部分
- 验证ref引用是否正确设置
- 查看控制台日志，确认重试机制是否正常工作

### 问题3：步骤数量不正确
- 确认tutorialSteps数组只包含4个步骤
- 验证步骤索引从0开始（0, 1, 2, 3）

### 问题4：页面切换不流畅
- 检查页面切换逻辑是否正确
- 验证延迟时间是否合适
- 查看控制台是否有错误信息

## 测试环境

- 浏览器：Chrome/Firefox/Safari
- 开发模式：确保 `isDevelopment` 为 `true` 以显示调试按钮
- 网络：确保能正常访问AI服务（用于测试按钮功能）

## 注意事项

1. 新手指引只引导四个核心功能按钮，不再包含方案评估、迭代等需要先生成方案的功能
2. 所有引导的按钮都是始终存在的，不依赖于页面状态
3. 引导过程中会自动切换页面部分，确保用户能看到正确的按钮
4. 新增了重试机制，提高了聚焦成功率
5. 开发模式下提供了调试工具，方便排查问题 