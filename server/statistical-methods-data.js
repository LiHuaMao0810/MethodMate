// 统计方法详细资料存储模块
// 存储常见统计方法的详细介绍，避免频繁调用AI API

const STATISTICAL_METHODS = {
  // 单样本t检验
  '单样本t检验': {
    keywords: ['单样本t检验', 'one sample t-test', 'one-sample t-test', '单样本t'],
    content: `# 单样本t检验(One Sample t-test)

在计量资料统计分析中，最简单和常用的方法是 **t 检验**（*t-test* / *Student's t-test*），包括：单样本 t 检验（One-sample t-test）、独立样本 t 检验（Independent-samples t-test）、配对样本 t 检验（Paired-samples t-test）。以下将举例介绍单样本 t 检验的适用条件及假设检验理论。

## 一、适用条件

单样本*t*检验，需要满足四个条件：

条件1：观察变量为连续变量。

条件2：观察变量相互独立。

条件3：观察变量不存在显著的异常值。

条件4：观察变量为(近似)正态分布。

## 二、统计量计算

单样本t检验（one sample/group t-test）即已知样本均数$\\bar{x}$（代表未知总体均数$\\mu$）与已知总体均数 $\\mu_0$（一般为理论值、标准值或经过大量观察所得的稳定值等）的比较。其检验统计量为：

$$t = \\frac{\\bar{x} - \\mu_0}{s/\\sqrt{n}}$$

其中，$df = n-1$为自由度（degree of freedom, df），指能够自由取值的变量个数。$s_{\\bar{x}} = s/\\sqrt{n}$为均数标准误的估计值，即样本均数的标准差，反映样本均数分布的离散程度，也反映样本均数与相应总体均数间的差异，说明了均数抽样误差的大小；与样本标准差的大小成正比，与样本含量$n$的平方根成反比。

## 三、案例数据

某医生测量了52名特殊作业成年男性工人的血红蛋白含量。假设已知正常成年男性血红蛋白含量均数为145g/L，试问特殊作业成年男性工人的血红蛋白含量是否与正常成年男性有差异？数据见下表1。

| ID | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| Hb(g/L) | 134 | 132 | 89 | 137 | 95 | 99 | 102 | 103 | 104 | 105 | 109 | 111 | 112 |

| ID | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 | 25 | 26 |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| Hb(g/L) | 115 | 115 | 119 | 116 | 124 | 125 | 125 | 125 | 126 | 127 | 127 | 127 | 127 |

| ID | 27 | 28 | 29 | 30 | 31 | 32 | 33 | 34 | 35 | 36 | 37 | 38 | 39 |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| Hb(g/L) | 128 | 128 | 128 | 123 | 128 | 124 | 129 | 130 | 134 | 135 | 136 | 139 | 150 |

| ID | 40 | 41 | 42 | 43 | 44 | 45 | 46 | 47 | 48 | 49 | 50 | 51 | 52 |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| Hb(g/L) | 151 | 156 | 157 | 159 | 161 | 162 | 145 | 148 | 165 | 130 | 135 | 129 | 132 |

**表1. 数据详情**

## 四、假设检验

### (一) 建立检验假设，确定检验水准

- $H_0$: $\\mu = 145$，即从事特殊作业的男性工人与正常成年男性的血红蛋白含量均数相等  
- $H_1$: $\\mu \\neq 145$，即从事特殊作业的男性工人与正常成年男性的血红蛋白含量均数不等  
- 显著性水平：$\\alpha = 0.05$

### (二) 计算检验统计量

本例 $n = 52$，$\\bar{x} = 128.9$，$s = 20.0$，$\\mu_0 = 145$。
按上述样本量公式计算得：

$$t = \\frac{128.9 - 145}{20.0/\\sqrt{52}} = -5.80$$

### (三) 确定 P 值，作出推断结论

以自由度 $df = 51$，查双侧 $t$ 分布表可得：

$P < 0.001$

因此，$P < 0.05$。

在 $\\alpha = 0.05$ 显著性水平下，拒绝原假设 $H_0$，接受备择假设 $H_1$，差异具有统计学意义。

结合本题，可认为从事特殊作业的男性工人的平均血红蛋白含量**低于**正常成年男性的平均血红蛋白含量。

## 五、分析小技巧

### (一) 异常值的检测

异常值的检测有多种方法，包括：

- **专业判断**。基于专业角度判断数值是否为异常值往往是最基础且可靠的方法，很多通过统计学方法检测提示的异常值，最终也需要从专业角度衡量是否为真正的异常值；但在实际研究过程中，一些变量指标难以从专业角度进行衡量是否异常。
- **图形法**，包括直方图法、箱式图法等。在直方图上，位于图形两端，并远离均数的数值，一般提示可能存在异常；在箱式图上位于上下四分位数±1.5倍四分位间距的数值，一般提示可能存在异常。
- **统计描述法**。一般位于均数±3倍标准差之外的数据，提示可能存在异常。
- **马氏距离法**，常用于多变量异常值的检测。

### (二) 异常值的处理

对于异常值的处理需要注意：

- 异常值产生的原因不明之前，不应简单决定其取舍，通过图形法和统计描述法检测出的异常值，最好再从专业角度进行判断是否为真正的异常值。
- 尽可能核对原始记录，如果确认数据有逻辑错误，又无法纠正，可直接删除。
- 如果数据无明显逻辑错误，可将数据删除前后各做一次分析，若结果不矛盾，则不予删除；若结果矛盾且需要删除数据时，必须给予充分合理的解释。
- 如果采用其他数值替换异常值，最好对替换前后的数据各做一次分析，并对结果进行比较。

**转自：** https://mengte.online/archives/194

SPSS实操案例：https://mengte.online/archives/214`
  },
  
  // 独立样本t检验
  '独立样本t检验': {
    keywords: ['独立样本t检验', 'independent samples t-test', 'independent t-test', '独立t检验', '成组t检验'],
    content: `# 独立样本t检验(Independent Samples t-test)

独立样本t检验又称成组t检验(two-sample/group t-test)或两独立样本t检验(two independent-sample t-test)，医学研究中常用于完全随机设计两样本均数的比较，即将受试对象完全随机分配到两个不同处理组，研究者关心的是两样本均数所代表的两总体均数是否不等。此外，在观察性研究中，独立从两个总体中进行完全随机抽样，获得的两样本均数的比较，也可采用独立样本t检验。

## 一、适用条件

独立样本 t 检验需要满足六个条件：

- **条件1**：观察变量为连续变量。
- **条件2**：观察变量相互独立。
- **条件3**：观察变量分为 2 组。
- **条件4**：观察变量不存在显著的异常值。
- **条件5**：各组观察变量为正态（或近似正态）分布。
- **条件6**：两组观察变量的方差相等。

## 二、统计量计算

当两样本均来自正态总体，但样本含量较小，如 $n_1 < 30$ 或/和 $n_2 < 30$ 时，要根据两总体方差是否相等而采用不同检验方法。

### (一) 总体方差相等的 t 检验

当两总体方差相等，即 $\\sigma_1^2 = \\sigma_2^2$ 时，可将两样本方差合并，求两者的共同方差——合并方差 $s_p^2$。

两样本 t 检验的检验统计量可按照单样本 t 检验 (One Sample t-test) 统计量计算公式进行计算，在 $H_0: \\mu_1 = \\mu_2$，即 $\\mu_1 - \\mu_2 = 0$ 条件下构造。其检验统计量为：

$$t = \\frac{(\\bar{x_1} - \\bar{x_2}) - (\\mu_1 - \\mu_2)}{s_{\\bar{x_1} - \\bar{x_2}}}$$

即

$$t = \\frac{\\bar{x_1} - \\bar{x_2}}{s_{\\bar{x_1} - \\bar{x_2}}}$$

=

$$t = \\frac{\\bar{x_1} - \\bar{x_2}}{s_p\\sqrt{\\frac{1}{n_1} + \\frac{1}{n_2}}}$$

=

$$t = \\frac{\\bar{x_1} - \\bar{x_2}}{\\sqrt{\\frac{s_p^2}{n_1} + \\frac{s_p^2}{n_2}}}$$

### (二) 总体方差不等的近似 t 检验

进行两小样本均数比较，若总体服从正态分布，但两总体方差不等，即 $\\sigma_1^2 \\neq \\sigma_2^2$ 时，可采用数据变换（如两样本几何均数的 t 检验，就是将原始数据取对数后进行 t 检验）或下述近似 t 检验——$t'$ 检验或秩转换的非参数检验。

近似 t 检验有以下三种方法可供选择：Cochran & Cox 法、Satterthwaite 法和 Welch 法。

#### 1. Cochran & Cox 近似 t 检验

Cochran & Cox 法 (1950) 的检验统计量为 $t'$，按下方公式计算。因 $t'$ 分布较复杂，故常利用 $t$ 计算其近似临界值。

$$t' = \\frac{\\bar{x_1} - \\bar{x_2}}{\\sqrt{\\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2}}}$$

$$t_{\\alpha(v)} = \\frac{t_{\\alpha(v_1)} \\cdot \\frac{s_1^2}{n_1} + t_{\\alpha(v_2)} \\cdot \\frac{s_2^2}{n_2}}{\\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2}}$$

$t'$ 值与 $P$ 值的关系同 $t$ 值与 $P$ 值的关系。注意：

1. 当 $s_1^2 = s_2^2$ 时，$t_{\\alpha(v)} = t_{\\alpha(v_1)} = t_{\\alpha(v_2)}$，$v = v_1 + v_2$（不是 $v_1 \\cdot v_2$）；
2. 用双侧概率时，$t_{\\alpha(v)}$ 取 $t_{\\alpha/2(v_1)}$ 和 $t_{\\alpha/2(v_2)}$。

#### 2. Satterthwaite 近似 t 检验

Cochran & Cox 法是对临界值校正，而 Satterthwaite 法 (1946) 则是对自由度校正。即用上述公式中的 $t'$ 代替 $t$，自由度校正按以下公式计算。最终结果根据 $t$ 界值表进行判定。

$$v' = \\frac{(\\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2})^2}{\\frac{(\\frac{s_1^2}{n_1})^2}{n_1-1} + \\frac{(\\frac{s_2^2}{n_2})^2}{n_2-1}}$$

#### 3. Welch 近似 t 检验

Welch 法 (1947) 也是对自由度进行校正。其校正按以下公式计算得：

$$v'' = \\frac{(\\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2})^2}{\\frac{(\\frac{s_1^2}{n_1})^2}{n_1+1} + \\frac{(\\frac{s_2^2}{n_2})^2}{n_2+1}} - 2$$

## 三、案例数据

某医生研究某生化指标(X)对病毒性肝炎诊断的临床意义，测得20名正常人和19名病毒性肝炎患者生化指标(X)含量(μg/dl)，问病毒性肝炎患者和正常人生化指标(X)含量是否存在差异？数据见下表。

| ID    | 1     | 2     | 3     | 4     | 5     | 6     | 7     | 8     | 9     | 10    |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| group | 1     | 1     | 1     | 1     | 1     | 1     | 1     | 1     | 1     | 1     |
| X     | 263.8 | 271.5 | 284.6 | 292.7 | 254.8 | 275.9 | 281.7 | 268.6 | 264.4 | 275.3 |

| ID    | 11    | 12    | 13    | 14    | 15    | 16    | 17    | 18    | 19    | 20    |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| group | 1     | 1     | 1     | 1     | 1     | 1     | 1     | 1     | 1     | 1     |
| X     | 270.8 | 262.3 | 275.9 | 281.7 | 268.6 | 264.4 | 273.2 | 270.9 | 260.5 | 264.4 |

| ID    | 21    | 22    | 23    | 24    | 25    | 26    | 27    | 28    | 29    | 30    |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| group | 2     | 2     | 2     | 2     | 2     | 2     | 2     | 2     | 2     | 2     |
| X     | 235.9 | 215.4 | 251.8 | 224.7 | 228.3 | 231.1 | 253   | 221.7 | 218.8 | 232.7 |

| ID    | 31    | 32    | 33    | 34    | 35    | 36    | 37    | 38    | 39    |       |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| group | 2     | 2     | 2     | 2     | 2     | 2     | 2     | 2     | 2     |       |
| X     | 230.9 | 240.7 | 255.8 | 260.7 | 224.4 | 232.7 | 231.5 | 240.7 | 257.3 |       |

**表1.具体数据**

## 四、假设检验

### (一) 方差齐性检验

此处使用Levene检验进行方差齐性检验，由于该检验的计算量巨大，使用jamovi软件完成计算过程。

方差齐性检验（Levene检验）

|      | F     | df   | df2  | p     |
| ---- | ----- | ---- | ---- | ----- |
| X    | 3.883 | 1    | 37   | 0.056 |

*注*：较低的p值提示可能违反方差齐性假设

### (二) Cochran & Cox近似t检验

#### 1. 建立检验假设，确定检验水准

H0：μ1= μ2，即病毒性肝炎患者和正常人生化指标(X)含量均数相等
H1：μ1 ≠ μ2，即病毒性肝炎患者和正常人生化指标(X)含量均数不等
a = 0.05

#### 2. 计算检验统计量

根据数据：

$n_1 = 20$, $n_2 = 19$, $\\bar{x_1} = 270.7$, $\\bar{x_2} = 235.9$

按Cochran & Cox近似t检验统计量计算公式得：

$t' = 9.352$,$t_{0.025(18)} = 2.101$, $t_{0.025(19)} = 2.093$

查t界值表,$t_{0.025(18)} = 2.101$,$t_{0.025(19)} = 2.093$,计算临界值：

$t_{0.05(v)} = \\frac{2.101 \\times 8.47 + 2.093 \\times 8.46}{8.47 + 8.46} = 2.098611$

#### 3. 确定P值，作出推断结论

由|t′|=9.352>2.098611得P<0.05。按a = 0.05水准，拒绝H0，接受H1，差异有统计学意义。可以认为病毒性肝炎患者和正常人生化指标(X)含量存在差异。

### (三) Satterthwaite近似t检验

#### 1. 建立检验假设，确定检验水准

$H_0$：$\\mu_1 = \\mu_2$，即病毒性肝炎患者和正常人生化指标(X)含量均数相等  

$H_1$：$\\mu_1 \\neq \\mu_2$，即病毒性肝炎患者和正常人生化指标(X)含量均数不等  

$\\alpha = 0.05$  

#### 2. 计算检验统计量

$n_1 = 20$, $n_2 = 19$, $\\bar{x_1} = 270.7$, $\\bar{x_2} = 235.9$，按Cochran & Cox近似t检验统计量计算公式得：  

$t' = 9.352$  ,$t_{0.025(18)} = 2.101$, $t_{0.025(19)} = 2.093$  

根据Satterthwaite法自由度校正公式计算可得：

$v' = \\frac{(8.47 + 8.46)^2}{\\frac{8.47^2}{19} + \\frac{8.46^2}{18}} = 36.97$  

#### 3. 确定P值，作出推断结论

以$df = 37$查t界值表得$t_{0.025(37)} = 2.026$，即$|t'| = 9.352 > 2.026$，得$P < 0.05$。按$\\alpha = 0.05$水准，拒绝$H_0$，接受$H_1$，差异具有统计学意义。可以认为病毒性肝炎患者和正常人生化指标(X)含量存在差异。结论与Cochran & Cox近似t检验一致。

### (四) Welch近似t检验

#### 1. 建立检验假设，确定检验水准

$H_0$：$\\mu_1 = \\mu_2$，即病毒性肝炎患者和正常人生化指标(X)含量均数相等  

$H_1$：$\\mu_1 \\neq \\mu_2$，即病毒性肝炎患者和正常人生化指标(X)含量均数不等  

$\\alpha = 0.05$  

#### 2. 计算检验统计量

$n_1 = 20$, $n_2 = 19$, $\\bar{x_1} = 270.7$, $\\bar{x_2} = 235.9$，按Cochran & Cox近似t检验统计量计算公式得：  

$t' = 9.352$  ，$t_{0.025(18)} = 2.101$, $t_{0.025(19)} = 2.093$  

根据Welch法自由度校正公式计算可得：

$v'' = \\frac{(8.47 + 8.46)^2}{\\frac{8.47^2}{21} + \\frac{8.46^2}{20}} - 2 = 36.97$  

#### 3. 确定P值，作出推断结论

以$df = 37$查t界值表得$t_{0.025(37)} = 2.026$，即$|t'| = 9.352 > 2.026$，得$P < 0.05$。按$\\alpha = 0.05$水准，拒绝$H_0$，接受$H_1$，差异具有统计学意义。可以认为病毒性肝炎患者和正常人生化指标(X)含量存在差异。结论与Cochran & Cox近似t检验和Satterthwaite近似t检验一致。

## 五、分析小技巧

- 在进行独立样本*t*检验时，正态性检验应分组进行，而不是对全部数据进行一次正态性检验。
- *t*检验对数据的非正态性有一定的耐受能力，如果资料只是稍微偏态，结果仍然稳健。
- 独立样本*t*检验时对两组数据之间的方差齐性要求较为严格，与数据违反正态性相比，方差不齐对结论的影响较大。
- 如果数据对条件1至条件5都满足，仅不满足方差齐，此时可使用校正t检验(Welch's *t*检验)。但如果数据的方差相差太大，最好使用非参数检验(Mann-Whitney U检验)。如果数据正态性和方差齐性都不满足，最好使用非参数检验(Mann-Whitney U检验)。
- 如果两组数据之间方差的差异无统计学意义，此时student's *t*检验比Welch's *t*检验具有更高的统计学检验效能(发生第II类错误的概率更低)，如果两组数据方差差异较大，此时Welch's *t*检验发生第II类错误的概率更低，结果更为可信。
- 与数据违反正态性相比，方差不齐对结论的影响较大，所以主要依靠假设检验进行考察。然而"方差齐性检验(Levene's)"的结果易受到样本量的影响，并不是很稳定。当样本量较大时，倾向于得出*P*值低于检验水准的结论，尽管可能组别之间的方差差异并不大；反之，当样本量较小时，尽管组别之间的方差差异可能较大，但倾向于得出*P*值高于检验水准的结论。因此，以统计描述的形式报告各组数据的具体标准差和方差，并将其纳入综合考量是必要的。

**转自：** https://mengte.online/archives/327

SPSS实操案例：https://mengte.online/archives/2171`
  },
  
  // 配对样本t检验
  '配对样本t检验': {
    keywords: ['配对样本t检验', 'paired samples t-test', 'paired t-test', '配对t检验'],
    content: `# 配对样本t检验(Paired Samples t-test)

配对样本t检验简称配(成)对t检验(paired/matched t-test)，也称关联样本t检验(related-sample t-test)，适用于配对设计或自身对照设计的计量资料的比较。配对设计是将受试对象按照某些重要特征(如性别、年龄等可疑混杂因素)配成对子，再将每对中的两个受试对象随机分配到两处理组。在医学科研中，配对设计主要有以下情形：①同一组研究对象身体不同部位配对，如癌组织与癌旁组织某种基因的表达、左手和右手的血压比较。②条件配对，如在同一窝老鼠中选择性别和体重相同的2只作为一个对子，组成多个对子；再将每个对子中的2只老鼠随机分配到2个处理组中去，然后比较两种处理方法的效果。③同一批标本不同检测方法配对，如同一批血液，被分成2份，分别用两种方法检测某种生化指标的含量。④还有一类特殊的研究设计，同一组研究对象干预前后配对，如同一组病人使用降血糖药物前后空腹血糖值的比较。对于这类设计，尽管可使用配对样本t检验进行数据分析，但严格来说并不属于配对设计，而是属于干预前后的重复测量设计。

## 一、适用条件

配对样本t检验需要满足五个条件：  

**条件1**：观察变量为连续变量。  

**条件2**：观察变量为配对设计。  

**条件3**：观察变量可分为2组。  

**条件4**：观察变量不存在显著的异常值。  

**条件5**：两个配对组别间观察变量的差值服从正态(或近似正态)分布。  

## 二、统计量计算

在将配对数据表差值后，配对t检验的实质与单样本t检验相同。以上述第②种情形条件配对为例，两同质受试对象配对分别接受两种不同处理。若两处理效应相同，即$\\mu_d = 0$(当已知总体均数$\\mu_0 = 0$))。即配对数据的差值应由图6上下波动，不会高于0太远，因此可将此类资料看成是差值的样本均数$\\bar{d}$所代表的未知总体均数$\\mu_0$与已知总体均数$\\mu_0 = 0$的比较，其检验统计量可按如下公式计算：

$$t = \\frac{\\bar{d} - \\mu_0}{s_d/\\sqrt{n}}$$

与单样本t检验统计量计算公式(单样本t检验-理论介绍)不同的是，$\\bar{d}$为每对数据的差值，$\\bar{d}$为差值的样本均数，$s_d$为差值的标准差，$s_d$为差值样本均数的标准误，$n$为对子数。

| ID   | Before | After  | 差值 $\\bar{d}$ |
| ---- | ------ | ------ | --------------- |
| 1    | 0.287  | 0.2745 | 0.0125          |
| 2    | 0.2921 | 0.2834 | 0.0087          |
| 3    | 0.295  | 0.2845 | 0.0105          |
| 4    | 0.305  | 0.287  | 0.018           |
| 5    | 0.323  | 0.2945 | 0.0285          |
| 6    | 0.343  | 0.296  | 0.047           |
| 7    | 0.3467 | 0.3217 | 0.025           |
| 8    | 0.354  | 0.2955 | 0.0585          |
| 9    | 0.3544 | 0.3113 | 0.0431          |
| 10   | 0.355  | 0.2755 | 0.0795          |
| 11   | 0.3578 | 0.3247 | 0.0331          |
| 12   | 0.364  | 0.325  | 0.039           |
| 13   | 0.3824 | 0.3456 | 0.0368          |
| 14   | 0.3936 | 0.3169 | 0.0767          |
| 15   | 0.399  | 0.352  | 0.047           |
| 16   | 0.313  | 0.2945 | 0.0185          |
| 17   | 0.333  | 0.299  | 0.034           |

## 三、假设检验

### （一）建立检验假设，确定检验水准

$H_0: \\mu_d = 0$，即两种方法对肌肉组织中生化指标(X)含量的检测结果无影响；

$H_1: \\mu_d \\neq 0$，即两种方法对肌肉组织中生化指标(X)含量的检测结果有影响。

$\\alpha = 0.05$

### （二）计算检验统计量

本例 $n = 17$

$\\bar{d} = 0.0386$, $s_d = 0.0213$

根据上面公式得：

$$t = \\frac{0.0386 - 0}{0.0213/\\sqrt{17}} = 7.468$$

## （三）确定P值，作出推断结论

以 $df = 16$ 查(界值表)得 $t_{0.025(16)} = 2.120$，得$P < 0.05$。按$\\alpha = 0.05$水准，拒绝$H_0$，接受$H_1$，差异有统计学意义。可以认为两种方法对肌肉组织中生化指标(X)含量的检测结果有影响。

**转自：** https://mengte.online/archives/331

SPSS实操案例：https://mengte.online/archives/2205`
  },
  
  // 单因素方差分析
  '单因素方差分析': {
    keywords: ['单因素方差分析', 'one-way anova', 'one way anova', '单因素anova', 'anova'],
    content: `# 单因素方差分析(One-way ANOVA)

单因素方差分析(One-way ANOVA)，又称完全随机设计的方差分析，是指采用完全随机化的分组方法，是将受试对象随机地分配到各个处理组，再比较各组均数之间的差别有无统计学意义，推论处理因素的效应。本篇文章举例介绍单因素方差分析的适用条件及假设检验。

## 一、适用条件

单因素方差分析，需要满足6个条件：

**条件1**: 观察变量为连续变量。

**条件2**: 观测值相互独立。

**条件3**: 观测值可分为多组(≥2)。

**条件4**: 观察变量不存在显著的异常值。

**条件5**: 各组观测值为正态(或近似正态)分布。

**条件6**: 多组观测值的整体方差相等。

## 二、统计量计算

### （一）单因素方差分析

当多组观察变量的整体方差相等时，即满足方差齐性时，可采用F检验进行单因素方差分析。当多组观察变量的整体方差不相等时，即不满足方差齐性时，可通过变量变换达到方差齐性要求，或者采用校正的单因素方差分析法(Welch检验)进行比较。

#### 1. F检验

单因素方差分析的总变异可拆分为组间变异和组内变异两部分：

$$SS_{总} = SS_{组间} + SS_{组内}$$

方差分析计算公式见表1，表中校正数 $C = \\frac{T^2}{N}$，$N$ 为样本量，$k$ 为处理组数。

| 变异来源     | 平方和 $SS$ | 自由度 $df$ | 均方 $MS$ | $F$ |
| ------------ | ----------- | ----------- | --------- | --- |
| **总变异**   | $SS_{总} = \\sum X^2 - C$ | $N-1$ |  |  |
| **组间变异** | $SS_{组间} = \\sum \\frac{T_i^2}{n_i} - C$ | $k-1$ | $MS_{组间} = \\frac{SS_{组间}}{k-1}$ | $F = \\frac{MS_{组间}}{MS_{组内}}$ |
| **组内变异** | $SS_{组内} = SS_{总} - SS_{组间}$ | $N-k$ | $MS_{组内} = \\frac{SS_{组内}}{N-k}$ |  |

**表1 单因素方差分析表**

#### **2. Welch检验**

Welch检验是指采用Welch分布的统计量检验各组均值是否相等。Welch分布近似于F分布，采用Welch检验对方差齐性没有要求，所以当数据的分布不满足方差齐性的要求时，采用Welch检验比F检验更稳妥。其计算公式如下：

$$F_w = \\frac{\\sum_{i=1}^{k} w_i(\\bar{x_i} - \\bar{x_w})^2}{k-1}$$

其中，$w_i = \\frac{n_i}{s_i^2}$，$\\bar{x_w} = \\frac{\\sum_{i=1}^{k} w_i \\bar{x_i}}{\\sum_{i=1}^{k} w_i}$，$n_i$为各组样本量，$k$为处理组数。

$$\\lambda = 1 + \\frac{2(k-2)}{k^2-1} \\sum_{i=1}^{k} \\frac{1}{n_i-1}(1 - \\frac{w_i}{\\sum_{j=1}^{k} w_j})^2$$

自由度：

$$df_2 = \\frac{k^2 - 1}{3\\lambda}$$

### **（二）多个样本均数的两两比较**

单因素方差分析整体比较，推断结论为拒绝$H_0$。接受$H_1$时，只能认为各总体均数之间整体比较有差异，但尚不能说明任意两个总体均数之间都有差别。若要进一步推断具体哪两个总体均数有差别，需要进一步事后检验(两两比较)。多个样本均数比较的事后检验可分为两种情况，一是各组间均要相互比较，以了解任何两组间是否有差别；二是仅考虑某指定组与其它各组比较，例如有一组为对照组，意欲了解其它各组均数与该对照组是否有差别。多重比较的方法很多，这里介绍三种方法，即适用于多组间两两比较的SNK法(q检验)，适用于某指定组与其它各组比较的Dunnett-t法(q检验)，以及适用于方差不齐的多组间两两比较的Games-Howell法。

#### **1. SNK法**

SNK法(Student-Newman-Keuls)用于比较每两个样本均数所代表的总体均数是否不同，其检验统计量为q，又称q检验。

$$q = \\frac{|\\bar{x_i} - \\bar{x_j}|}{\\sqrt{\\frac{MS_e}{2}(\\frac{1}{n_i} + \\frac{1}{n_j})}}$$

式中 $\\bar{x_i}$、$\\bar{x_j}$为两对比组的样本均数，$MS_e$为方差分析中算得的误差均方(或称组内均方)，$n_i$和$n_j$分别对两对比组样本例数。

#### **2. Dunnett-t法**

Dunnett-t法适用于多个实验组与一个对照组间的两两比较，其检验统计量为q'，又称q'检验。

$$q' = \\frac{|\\bar{x_i} - \\bar{x_0}|}{\\sqrt{MS_e(\\frac{1}{n_i} + \\frac{1}{n_0})}}$$

上式中 $\\bar{x_i}$ 与 $n_i$ 为实验组均数和样本例数，$\\bar{x_0}$ 与 $n_0$ 为对照组均数和样本例数。算得q'值后需查(q'界值表c)，(q'界值表c')中的u仍为方差分析中误差项的自由度，a仍为两对比组包含的组数。

#### **3. Games-Howell法**

Games-Howell法适用于方差不齐的多组间的两两比较。这种方法背后的理念是关注两组平均值之间差异的最大值。其统计量计算为：

$$q = \\frac{|\\bar{x_i} - \\bar{x_j}|}{\\sqrt{\\frac{s_i^2}{n_i} + \\frac{s_j^2}{n_j}}}$$

$n$为每组样本量。统计量q的分布称为studentized range q分布。该分布的临界值在基于a、k(组数和df_w值的(studentized range q表c')中给出。如果$q > q_{临界}$，则两组均值有统计学差异。

此检验相当于

$$t = \\frac{|\\bar{x_i} - \\bar{x_j}|}{\\sqrt{\\frac{s_i^2}{n_i} + \\frac{s_j^2}{n_j}}} > t_{\\alpha/2,df}$$

## 三、案例数据

某医生用A、B、C三种方案治疗血红蛋白低下的贫血患者，治疗两个月后，记录每名受试者血红蛋白的上升克数。问3种治疗方案对患者贫血的疗效是否有差别？具体数据见表2。

| ID    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   | 15   |
| ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| group | A    | A    | A    | A    | A    | A    | A    | A    | A    | A    | A    | A    | A    | A    | A    |
| Hb    | 0.5  | 0.6  | 0.5  | 0.7  | 0.8  | 0.9  | 1    | 1.1  | 1.2  | 1.4  | 1.4  | 1.5  | 1.5  | 1.6  | 1.6  |

| ID    | 16   | 17   | 18   | 19   | 20   | 21   | 22   | 23   | 24   | 25   | 26   | 27   | 28   | 29   | 30   |
| ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| group | A    | A    | A    | A    | A    | A    | A    | A    | A    | A    | A    | B    | B    | B    | B    |
| Hb    | 1.7  | 1.8  | 2    | 2.3  | 2.3  | 2.4  | 2.5  | 2.7  | 3    | 3.2  | 3.7  | 0.4  | 0.1  | 0.1  | 0.2  |

| ID    | 31   | 32   | 33   | 34   | 35   | 36   | 37   | 38   | 39   | 40   | 41   | 42   | 43   | 44   | 45   |
| ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| group | B    | B    | B    | B    | B    | B    | B    | B    | B    | B    | B    | B    | B    | B    | B    |
| Hb    | 0.3  | 0.5  | 0.7  | 0.7  | 1    | 1.2  | 1.6  | 1.6  | 1.6  | 1.9  | 2    | 2    | 2.4  | 2.5  | 2.7  |

| ID    | 46   | 47   | 48   | 49   | 50   | 51   | 52   | 53   | 54   | 55   | 56   | 57   | 58   | 59   | 60   |
| ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| group | B    | B    | B    | B    | B    | B    | B    | C    | C    | C    | C    | C    | C    | C    | C    |
| Hb    | 1.3  | 1.3  | 1.2  | 1.2  | 1.1  | 1.4  | 1.5  | 0.7  | 0.3  | 0.2  | 0.2  | 0.2  | 0.7  | 0.7  | 0.8  |

| ID    | 61   | 62   | 63   | 64   | 65   | 66   | 67   | 68   | 69   | 70   | 71   | 72   | 73   | 74   | 75   |
| ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| group | C    | C    | C    | C    | C    | C    | C    | C    | C    | C    | C    | C    | C    | C    | C    |
| Hb    | 0.9  | 0.9  | 1.1  | 1.1  | 1.3  | 1.3  | 1.4  | 1.5  | 1.7  | 1.9  | 2    | 2.1  | 1    | 1    | 1.2  |

| ID    | 76   | 77   | 78   |      |      |      |      |      |      |      |      |      |      |      |      |
| ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| group | C    | C    | C    |      |      |      |      |      |      |      |      |      |      |      |      |
| Hb    | 1.2  | 0.6  | 0.6  |      |      |      |      |      |      |      |      |      |      |      |      |

表2

## 四、假设检验

### （一）正态性检验

在方差分析中，有两种选择来检验正态性(参考"方差分析的基本思想和应用条件")。本例中一共有3个分组，每个分组有很多观测值，那么可以检验每组观测值的正态性。本文采用jamovi软件进行数据的正态性检验，具体过程参考"单因素方差分析-jamovi软件实现"，结果如图1和图2所示。

图1和图2按照组别列出了三组的正态性检验结果。图1的Q-Q图上三组散点基本围绕对角线分布，提示三组数据呈正态分布；图2的正态性检验结果分别显示三组的*P*=0.296、0.486、0.435，均>0.1，也提示三组数据满足正态性条件。综上，本案例满足正态性条件。

### (二) 方差齐性检验

此处使用Levene检验进行方差齐性检验，使用jamovi软件完成计算过程，具体操作详见"单因素方差分析—jamovi软件实现"，结果如图3和图4所示。

由图3"Descriptives（描述性分析）"表格中"Std. deviation（标准差）"和"Variance（方差）"结果可知，A、B、C三组的标准差分别为0.867、0.738、0.538，方差分别为0.752、0.545和0.290，三组的方差数值存在差异，但还需要依据统计学检验的结果进行判断。

图4"Homogeneity of Variances Test (Levene's) (Levene's方差齐性检验)"为方差齐性检验结果，可见 $F = 4.83$，$P = 0.011 < 0.05$，提示三组数据方差不齐，不满足方差齐性的要求。

本案例数据满足正态性要求，不满足方差齐性要求，但方差并非严重不齐，可采用Welch检验进行数据分析。

### （三）单因素方差分析(Welch检验)

#### 1. 建立检验假设，确定检验水准

$H_0: \\mu_A = \\mu_B = \\mu_C$

即三种治疗方案受试者血红蛋白的上升克数相等

$H_1: \\mu_A, \\mu_B, \\mu_C$ 不全相等

三种治疗方案受试者血红蛋白的上升克数不全相等

$\\alpha = 0.05$

#### 2. 计算检验统计量

本案例中A、B、C三组的样本量分别为 $n_A = 26$、$n_B = 26$、$n_C = 26$，三组的均数分别为 $\\bar{x_A} = 1.665$、$\\bar{x_B} = 1.227$、$\\bar{x_C} = 1.000$，三组的标准差分别为 $s_A = 0.867$、$s_B = 0.738$、$s_C = 0.538$。

根据Welch检验统计量计算公式可计算相应参数值为：

$w_A = \\frac{26}{0.867^2} = 34.62$

$w_B = \\frac{26}{0.738^2} = 47.76$

$w_C = \\frac{26}{0.538^2} = 89.88$

$\\bar{x_w} = \\frac{34.62 \\times 1.665 + 47.76 \\times 1.227 + 89.88 \\times 1.000}{34.62 + 47.76 + 89.88} = 1.237$

$F_w = \\frac{34.62(1.665-1.237)^2 + 47.76(1.227-1.237)^2 + 89.88(1.000-1.237)^2}{3-1} = 7.63$

$\\lambda = 1 + \\frac{2(3-2)}{3^2-1} \\times 0.259 = 1.065$

$df_2 = \\frac{3^2 - 1}{3 \\times 1.065} = 2.50$

#### 3. 确定 $P$ 值，作出推断结论

以 $df_1 = 2$，$df_2 = 2.50$ 查（$F$ 界值表）得 $F_{0.05(2,2.50)} = 9.00$。本例 $F_w = 7.63 < 9.00$，则 $P > 0.05$。按 $\\alpha = 0.05$ 检验水准，拒绝 $H_0$，接受 $H_1$，差异有统计学意义，表明三种治疗方案受试者血红蛋白的上升克数不全相等。

### （四）多个样本均数间的多重比较 (Games-Howell法)

方差不齐时，多个均数事后检验两两比较常采用 Games-Howell 法。

#### 1. 建立检验假设，确定检验水准

$H_0: \\mu_i = \\mu_j$ (i≠j)

即任何两种治疗方案受试者血红蛋白的上升克数相等

$H_1: \\mu_i \\neq \\mu_j$ (i≠j)

即任何两种治疗方案受试者血红蛋白的上升克数不等

$\\alpha = 0.05$

#### 2. 计算检验统计量

**A组与 B 组治疗方案比较**：

$\\bar{x_A} - \\bar{x_B} = 1.665 - 1.227 = 0.438$

$SE = \\sqrt{\\frac{0.867^2}{26} + \\frac{0.738^2}{26}} = 0.158$

$q = \\frac{0.438}{0.158} = 2.77$

$df = 49$

基于 ( $\\alpha$ = 0.05 )、$k$ (组数)=3和 $df$ = 49 的(studentized range q 表)，可得 ( $q_{临界}$ = 3.418 )，所以
$q = 2.77 < 3.418$。

同理可计算出其他两组的统计量，如表3所示：

| group  | $\\bar{x_i} - \\bar{x_j}$ | $SE$ | $df$ | $q_{临界}$ | $q$ |
| ------ | ------------------------ | ---- | ---- | ---------- | --- |
| A vs B | 0.438                    | 0.158| 49   | 3.418      | 0.540 |
| A vs C | 0.665                    | 0.142| 42   | 3.436      | 0.486 |
| B vs C | 0.227                    | 0.127| 46   | 3.425      | 0.434 |

表3

1. 确定$P$值，作出推断结论

根据表3中的统计量，A组和C组相比时，$q = 4.68 > 3.436$，可得$P < 0.05$。按$\\alpha = 0.05$水准，拒绝$H_0$，接受 $H_1$，差异具有统计学意义，说明A组和C组治疗方案受试者血红蛋白的上升克数不相等。而其余两组$q < q_{临界}$，可得 $P > 0.05$。按 $\\alpha = 0.05$水准，不拒绝$H_0$，差异不具有统计学意义。

**转自：** https://mengte.online/archives/920

SPSS实操案例：https://mengte.online/archives/2066`
  },
  
  // Wilcoxon符号秩检验
  'wilcoxon符号秩检验': {
    keywords: ['wilcoxon符号秩检验', 'wilcoxon signed rank test', '单样本wilcoxon', 'wilcoxon检验', '符号秩检验', '非参数检验'],
    content: `# 单样本Wilcoxon符号秩检验(One Sample Wilcoxon Signed Rank Test)

非参数检验(nonparametric test)是相对于参数检(parametric test)而言。秩转换的非参数检验是先将数值变量资料从小到大、等级资料从弱到强转换成秩后，再计算检验统计量，其特点是假设检验的结果对总体分布的形状差别不敏感，只对总体分布的位置差别敏感。

### 简介：

对于以下情形，常使用秩转换的非参数检验：①对于计量资料，若不满足正态和方差齐性条件，这时小样本资料选t检验或F检验是不妥的，而选秩转换的非参数检验是恰当的；②对于分布不知是否正态的小样本资料，为保险起见，宜选秩转换的非参数检验；③对于一端或两端是不确定数值(如<20岁、≥65岁等)的资料，不管是否正态分布，只能选秩转换的非参数检验；④对于等级资料，若选择行×列(R×C)列联表资料的检验，只能推断构成比差别，而选择秩转换的非参数检验，可推断等级强度差别。

需要注意的是，如果已知计量资料满足(或近似满足)t检验或F检验条件，应选t检验或F检验；若选秩转换的非参数检验，会降低检验效能。

秩转换的非参数检验主要包括单个样本中位数和总体中位数比较的单样本Wilcoxon符号秩检验(One Sample Wilcoxon Signed Rank Test)、两个独立样本比较的Wilcoxon秩和检验 (Wilcoxon Rank Sum Test)、配对样本差值的中位数和0比较的配对样本Wilcoxon符号秩检验(Paired Samples Wilcoxon Signed Rank Test)、完全随机设计多个独立样本比较的Kruskal-Wallis H检验(Kruskal-Wallis H Test)、随机区组设计多个相关样本比较的Friedman M检验(The Friedman Non-parametric Repeated Measures ANOVA Test)。本篇文章将举例介绍单样本Wilcoxon符号秩检验的假设检验理论。

## 一、适用条件

单样本Wilcoxon符号秩检验的目的是推断样本所来自的总体中位数$M$和某个已知的总体中位数$M_0$是否有差别。用样本各变量值和$M_0$的差值，即推断差值的总体中位数和$0$是否有差别。其适用条件为：观察变量为不满足正态分布的连续变量。

## 二、统计量计算

### （一）T值法

T值法是指对数据编号计算后，通过T值表确定P值，做出统计推断。

#### 1. 检验统计量T值的计算

1. 每个样本数据都与已知总体中位数$M_0$配成对子，并计算差值；  
2. 省略所有差值为$0$的对子数，令余下的有效对子数为$n$；  
3. 按$n$个差值的绝对值从小到大编正秩和负秩，递增值的绝对值相等者取平均秩，称为相同秩（ties）（样本较小时，如果相同秩较多，检验结果会存在偏性，因此应提高测量精度，尽量避免出现较多相同秩）；  
4. 任意取正秩和（$T^+$）或负秩和（$T^-$）为$T$。

#### 2. 确定P值，做出统计推断

当$n \\leq 25$时，查（T值界值表）。查表时，自左侧找到$n$，将检验统计量$T$值与相邻左侧一栏的界值相比：  

- 若$T$在上、下界值范围内，其$P$值大于表上方相应概率水平；  
- 若$T$值恰好等于界值，其$P$值等于（一般是近似等于）相应概率水平；  
- 若$T$值在上、下界值范围外，其$P$值小于相应概率水平，可向右移一栏，再与界值相比。

#### 3. T界值表制作的原理

为简单起见，现以对子数为$n=4$进行介绍（T界值表）的编制原理：
假定配对的有效对子数$n=4$，总体秩为$1,2,3,4$。正秩（或负秩）从总体中取秩，可取$0$个、$1$个、$2$个、$3$个和$4$个，取秩的$2^4=16$种可能组合情况及秩和$T$见图1。

每种组合情况对应的$T$取值的概率为$1/16$。归纳成$n=4$时$T$的概率分布见图2。

$T$的概率分布是对称的非连续分布。$T$的最小值为$0$，最大值为$n(n+1)/2$，均数为$n(n+1)/4$。如$n=4$时，最大值为$10$，均数为$2.5$。

根据图2可计算$n=4$时$T$的单侧和双侧累计概率。如下：  

- $T$为$0$或$10$的单侧累计概率等于$1/16$（$P=0.062$或$P=0.937$），双侧累计概率等于$2/16$（$P=0.125$）；  
- $T$为$1$~$9$的单侧累积概率等于$2/16$（$P=0.125$或$P=0.875$），双侧累积概率等于$4/16$（$P=0.25$）。

无论$n$有多大，其$T$界值的制作步骤和$n=4$时相同。由于$n=4$时最小单侧累计概率大于$0.05$，故（T界值表）的$n$从$6$起。$T$的下侧界值与上侧界值之和为$n(n+1)/2$，由于正秩和（$T^+$）与负秩和（$T^-$）之和均为$n(n+1)/2$，故若正秩和（$T^+$）、负秩和（$T^-$）中的小者小于或等于下侧界值，则大者大于或等于上侧界值。

### （二）正态近似法

当$n$增加时，$T$分布接近均数为$n(n+1)/4$，方差为$n(n+1)(2n+1)/24$的正态分布。当$n \\geq 25$时，近似程度已较为满意，故可按照正态分布的原理，利用以下公式计算$Z$值：

$$Z = \\frac{T - n(n+1)/4}{\\sqrt{n(n+1)(2n+1)/24}} \\pm 0.5$$

公式中的$0.5$是连续校正系数，因为$Z$值是连续的，而$T$值是不连续的。

当相同的秩次较多时（指绝对值，不包括差值为$0$者），用上述公式求得的$Z$值偏小，需用以下公式进行校正：

$$Z_c = \\frac{T - n(n+1)/4}{\\sqrt{n(n+1)(2n+1)/24 - \\sum t_i(t_i^2-1)/48}} \\pm 0.5$$

式中$t_i$为第$i$个相同秩的个数。假定相同秩（即平均秩）中有2个4，5个6，3个7，则：
$\\sum t_i(t_i^2-1)/48 = \\frac{2(2^2-1) + 5(5^2-1) + 3(3^2-1)}{48}$，
$= \\frac{2 \\times 3 + 5 \\times 24 + 3 \\times 8}{48} = \\frac{6+120+24}{48} = \\frac{150}{48} = 3.125$。

## 三、案例数据

某地正常人尿氟含量的中位数为$45.2μg/L$。今在该地某厂随机抽取$12$名工人，测得尿氟含量。问该厂工人的尿氟含量是否与当地正常人的尿氟含量有差异？数据见图3。

## 四、假设检验

本例样本资料经 "Normality Test (Shapiro-Wilk) (夏皮罗-威尔克正态性)"正态性检验结果显示*P*=0.062<0.1，提示数据不满足正态性条件。可使用单样本Wilcoxon符号秩检验。

### （一）建立检验假设，确定检验水准

$H_0$：尿氟含量的总体中位数 $M = 45.2μg/L$
$H_1$：$M \\neq 45.2μg/L$
$\\alpha = 0.05$  

### （二）计算检验统计量  

#### **1.计算差值**

使用新发减去原法计算两组数据的差值，即图4中(2)=(1)-45.2。  

#### **2.编秩**

(1) 将图4中差值都取绝对值。

(2) 以绝对值的大小从小到大编秩次（即编秩序号）：若遇到差值为0的对子数应舍去，同时样本例数相应减少；若遇到绝对值相等的差值，则取平均秩次，又称同秩或结。

(3) 让秩次保持原差值的正负号（即符号秩）。

(4) 求秩和，正秩和（$T^+$）为76，负秩和（$T^+$）为2。本例有效差值个数$n=12$，则总秩和为

$$\\frac{n(n+1)}{2} = \\frac{12 \\times 13}{2} = 78$$

   正秩和与负秩和相加为76+2=78，秩和计算无误。  

#### **3.计算T值**

据图4第(3)和(4)栏，取$T^+ = 76$或$T^- = 2$。

### （三）确定P值，作出推断结论

本例有效差值个数$n = 12$。据$n = 12$和$T^+ = 76$或$T^- = 2$查（$T$界值表 ），得单侧$P = 0.005 < 0.05$，按$\\alpha = 0.05$水准，拒绝$H_0$，接受$H_1$，可认为该厂工人的尿氟含量高于当地正常人的尿氟含量。

**转自：** https://mengte.online/archives/333

SPSS实操案例：https://mengte.online/archives/2245`
  }
};

// 方法匹配函数
const findStatisticalMethod = (queryMethod) => {
  if (!queryMethod || typeof queryMethod !== 'string') {
    return null;
  }
  
  const query = queryMethod.toLowerCase().trim();
  
  // 遍历所有预存的方法
  for (const [methodName, methodData] of Object.entries(STATISTICAL_METHODS)) {
    // 检查是否匹配任何关键词
    const isMatch = methodData.keywords.some(keyword => {
      const keywordLower = keyword.toLowerCase();
      return query.includes(keywordLower) || keywordLower.includes(query);
    });
    
    if (isMatch) {
      return {
        method: methodName,
        content: methodData.content,
        isLocalContent: true
      };
    }
  }
  
  return null;
};

export {
  STATISTICAL_METHODS,
  findStatisticalMethod
}; 